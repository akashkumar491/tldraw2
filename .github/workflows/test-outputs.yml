name: Test outputs
# This bumps the patch version, updates the changelogs in the release branch only, publishes a GitHub release, and publishes the packages to npm.

# Path releases are triggered by merging a PR which targets a 'release' branch named e.g. 'v2.0.x'.
on: pull_request

jobs:
  deploy:
    name: Test outputs
    timeout-minutes: 15
    runs-on: ubuntu-latest-16-cores-open

    outputs:
      my_output_name: ${{ steps.thing_job_id.outputs.the_output }}
    steps:
      - name: Check out code
        uses: actions/checkout@v3

      - name: Run our setup
        uses: ./.github/actions/setup

      - name: thing
        id: thing_job_id
        run: |
          yarn tsx ./scripts/append_to_output.ts

  other_thing:
    name: Does a thing
    timeout-minutes: 15
    runs-on: ubuntu-latest-16-cores-open
    steps:
      - name: Thing
        run: echo ${{ needs.deploy.outputs.my_output_name }}
    needs: deploy
